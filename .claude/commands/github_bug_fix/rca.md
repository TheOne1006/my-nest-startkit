---
description: 分析并记录 GitHub 问题的根本原因 (Root Cause Analysis)
argument-hint: [github-issue-id]
---

# 根本原因分析 (RCA): GitHub Issue #$ARGUMENTS

## 目标

调查此存储库中的 GitHub 问题 #$ARGUMENTS，确定根本原因，并记录调查结果以供后续实施。

**先决条件:**
- 在具有 GitHub 远程源的本地 Git 存储库中工作
- 已安装 GitHub CLI 并已验证身份 (`gh auth status`)
- 来自此存储库的有效 GitHub 问题 ID

## 调查流程

### 1. 获取 GitHub 问题详情

**使用 GitHub CLI 检索问题信息:**

```bash
gh issue view $ARGUMENTS
```

这将获取：
- 问题标题和描述
- 报告人和创建日期
- 标签和状态
- 评论和讨论

### 2. 搜索代码库

**识别相关代码:**
- 搜索问题中提到的组件
- 查找相关的功能、类或模块
- 检查类似的实现
- 寻找模式或最近的更改

使用 grep/search 查找：
- 问题中的错误消息
- 相关函数名称
- 组件标识符 (Controllers, Services, DTOs)

### 3. 审查近期历史

检查受影响区域的最近更改：
!`git log --oneline -20 -- [relevant-paths]`

寻找：
- 最近对受影响代码的修改
- 相关的错误修复
- 可能引入问题的重构

### 4. 调查根本原因

**分析代码以确定:**
- 实际的错误或问题是什么？
- 为什么会发生这种情况？
- 最初的意图是什么？
- 这是逻辑错误、边缘情况还是缺少验证？
- 是否有相关问题或症状？

**考虑:**
- 输入验证失败 (class-validator)
- 未处理的边缘情况
- 竞态条件或时序问题
- 不正确的假设
- 缺少错误处理 (Exception Filters)
- 组件之间的集成问题 (DI, Modules)
- 数据库事务或查询问题 (Prisma)

### 5. 评估影响

**确定:**
- 此问题有多普遍？
- 哪些功能受到影响？
- 是否有变通方法？
- 严重程度如何？
- 这会导致数据损坏或安全问题吗？

### 6. 提出修复方案

**设计解决方案:**
- 需要更改什么？
- 将修改哪些文件？
- 修复策略是什么？
- 是否有替代方案？
- 需要什么测试 (Unit, E2E)？
- 是否有任何风险或副作用？

## 输出: 创建 RCA 文档

将分析保存为: `.claude/rca/issue-$ARGUMENTS.md`

### 必需的 RCA 文档结构

```markdown
# 根本原因分析: GitHub Issue #$ARGUMENTS

## 问题摘要
简要描述问题。

## 根本原因
详细解释导致问题的根本原因。

## 影响评估
受影响的组件和潜在风险。

## 拟议的修复方案
详细的修复步骤和策略。

## 验证计划
- [ ] 单元测试用例
- [ ] E2E 测试场景
- [ ] 验证命令 (lint, build, test)
```
